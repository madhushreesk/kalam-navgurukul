import{aT as e,b$ as ce,ba as G,bh as M,aI as y,bb as i,bk as q,bs as C,b0 as ee,bo as E,bq as F,bt as L,br as Y,bf as te,aV as R,aX as ue,cn as pe,bp as ae,cx as me,cO as he,aU as ge,cP as fe,bi as re,cu as ye,cY as be,bv as x,cV as ke,cW as Se,cX as ve,bw as V,bz as j,bA as U,bB as I,cS as z,bF as Ce,bl as De,cZ as xe,ca as $e,b as Te,cd as Re,bd as Be}from"./vendor.5ecbfc3b.js";import{a as v}from"./vendor_axios.5abceb0c.js";import{L as Pe,N as we,B as N,M as Le,C as Ae}from"./index.48474fd0.js";import Ie from"./ViewAssessments.ad8ae1da.js";import We from"./AddPartner.3e7da3cb.js";import{u as Oe,a as Ne,C as W}from"./vendor_react_hook_form.882a249a.js";import"./vendor_core_js_pure.42317256.js";import"./vendor_react_epic_spinners.391a1898.js";import"./vendor_mui_datatables.cb4acd6b.js";import"./vendor_lodash.e638c0fa.js";import"./vendor_react_slick.f5eccc0b.js";import"./vendor_react_easy_edit.a45942fe.js";import"./vendor_react_player.581c7f95.js";import"./vendor_react_json_view.741f6318.js";const Q=({text:s,url:t})=>e(ce,{target:"_blank",style:{color:"#f05f40"},to:{pathname:t},children:s}),Me="https://join.navgurukul.org/api/",qe=G(s=>({container:{display:"flex",flexWrap:"wrap",flexDirection:"column",maxWidth:400},btn:{marginTop:s.spacing(4)},text:{marginBottom:s.spacing(1)}})),Ee=({name:s,notes:t,partnerId:a,change:l,columnIndex:c})=>{const m=qe(),{enqueueSnackbar:u}=M(),[g,k]=y.useState(!1),[d,o]=y.useState({name:s!=null?s:"",notes:t!=null?t:"",slug:""}),S=async()=>{try{const b=`${Me}partners/${a}`;await v.put(b,{name:d.name,notes:d.notes,slug:d.slug}).then(()=>{k(!1),u("Partner successfully edited with slug!",{variant:"success"}),l(d.slug,c)})}catch{u("All fields are mandatory Or Slug should be unique",{variant:"error"})}},B=()=>S(),$=b=>{o({...d,[b.target.name]:b.target.value})},P=()=>{k(b=>!b)};return i(q,{children:[e(C,{variant:"outlined",startIcon:e(ee,{}),onClick:P,children:"Add Slug"}),i(E,{open:g,onClose:P,children:[i(F,{className:m.container,children:[e(L,{id:"partnerName",name:"name",label:"Partner Name",value:d.name,onChange:$,helperText:"Partner ka Name Enter karein."}),e(L,{id:"partnerNotes",name:"notes",value:d.notes,label:"Partner Notes",onChange:$,helperText:"Partner ka Name Enter karein."}),e(L,{id:"partnerSlug",name:"slug",value:d.slug,label:"Partner Slug",onChange:$,helperText:"Partner ke student ko online test dene ke liye Slug add karo."})]}),i(Y,{children:[e(C,{variant:"outlined",onClick:P,children:"Cancel"}),e(C,{variant:"contained",color:"primary",onClick:B,children:"Edit Partner"})]})]})]})},Fe="https://join.navgurukul.org/api/",_e=s=>{const t=M(),[a,l]=y.useState({dialogOpen:!1,inputValue:"",loading:!1}),c=async()=>{const{partnerId:o}=s,S=`${Fe}partners/${o}/assessments`;await v.post(S,{name:a.inputValue}).then(()=>{l({...a,loading:!1}),t.enqueueSnackbar("Assessment successfully created!",{variant:"success"})}).catch(B=>{t.enqueueSnackbar(B,{variant:"error"})})},m=()=>{l({...a,dialogOpen:!1})},u=async()=>{m(),l(o=>({...o,loading:!0})),c()},g=()=>{l({...a,dialogOpen:!0})},k=o=>{l({...a,inputValue:o.target.value})},{loading:d}=a;return i(q,{children:[i(te,{children:[d?null:e(R,{onClick:g,children:e(ue,{})}),e(pe,{size:35,color:"#ed343d",width:5,visible:d})]}),i(E,{open:a.dialogOpen,onClose:m,children:[e(ae,{id:"form-dialog-title",children:"Create New Assessment"}),i(F,{children:[e(me,{children:"Please fill out the paper set name"}),e(L,{label:"Paper set name",value:a.inputValue,placeholder:"Set A",onChange:k,margin:"normal"})]}),e(Y,{children:e(C,{color:"primary",variant:"contained",onClick:u,children:"CREATE"})})]})]})},Ve="https://join.navgurukul.org/api/",je=G(s=>({container:{display:"flex",justifyContent:"center",alignItems:"center"},link:{color:"#f05f40",padding:s.spacing(3,1)}})),Ue=({isValue:s,studentId:t,updateValue:a})=>{const l=je(),{enqueueSnackbar:c}=M(),m=async()=>{v({method:"put",url:`${Ve}partners/${t}/merakiLink`,headers:{platform:"android"}}).then(u=>{c("Meraki link successfully created",{variant:"success"});const g=u.data.data.meraki_link;a(g)}).catch(()=>{c("Something went wrong",{variant:"error"})})};return s?i("div",{className:l.container,children:[e(he,{text:s,onCopy:(u,g)=>{g&&c("Link Copied!",{variant:"success"})},children:e(ge,{title:"Copy Meraki Link",style:{background:"#f05f40"},children:e(R,{children:e(fe,{sx:{color:"white"}})})})}),e("a",{className:l.link,href:s,target:"_blank",rel:"noreferrer noopener",children:"Get Link"})]}):e(C,{variant:"contained",color:"primary",onClick:()=>m(),children:"Create"})},ze=s=>{const{privileges:t}=re(g=>g.auth),[a,l]=y.useState(!1),c=()=>l(!1),m=()=>l(!0),{value:u}=s;return i(q,{children:[e(R,{disabled:!t.some(g=>g.privilege==="UpdatePartner"),onClick:m,children:e(ee,{})}),e(E,{scroll:"paper",open:a,onClose:c,children:e(F,{dividers:!0,children:e(We,{partnerId:u,closeDialog:c})})})]})},O="https://join.navgurukul.org/api/",Ge=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Ye=[...Array(31)].map((s,t)=>t+1),Ze=({partnerId:s})=>{var X,J,K;const{enqueueSnackbar:t}=M(),[a,l]=y.useState(!0),[c,m]=y.useState(!1),[u,g]=y.useState({emails:[""],repeat:"Daily",date:[],status:1,report:"Outreach",emailreportId:null}),{handleSubmit:k,formState:{errors:d},control:o,watch:S,reset:B,setValue:$}=Oe(),{fields:P,append:b,remove:ne}=Ne({control:o,name:"emails"}),Z=(p,r)=>p==="Daily"?p:`${p} ${["Bi-Weekly","Bi-Monthly"].includes(p)?r.join(" "):r}`,A=()=>m(!1),le=p=>{const{emails:r,repeat:n,date:h,status:f,report:w}=p;v.post(`${O}partners/emailreport`,{partner_id:s,emails:r.map(_=>_.email),repeat:Z(n,h),status:!!f,report:w}).then(()=>{t(`Report ready to share  ${n} bases`,{variant:"success"}),A()})},se=async p=>{const{report:r,emailreportId:n,emails:h,repeat:f,date:w,status:_}=p;v.put(`${O}partners/emailreport/${n}`,{partner_id:s,emails:h.map(de=>de.email),repeat:Z(f,w),status:!!_,report:r}).then(()=>{t("Report successfully updated",{variant:"success"}),A()})},ie=()=>{v.get(`${O}emailreport/send/partner/${s}`).then(()=>{t("Instant Report Sent!!!",{variant:"success"})})},oe=()=>{m(!0),v.get(`${O}partners/emailreport/${s}`).then(p=>{const r=p.data.data[0];if(r){const n=r.repeat.split(" "),h=n.splice(1,n.length);g(f=>({...f,emails:r.emails.map(w=>({email:w})),repeat:n[0],date:h,status:r.status?1:0,report:r.report,emailreportId:r.id})),B({emails:r.emails.map(f=>({email:f})),repeat:n[0],date:h,status:r.status?1:0,report:r.report,emailreportId:r.id}),l(!1)}})},D=S("repeat"),H=S("date"),T=(D==null?void 0:D.indexOf("Weekly"))>-1;return i("div",{children:[e(R,{onClick:oe,children:e(ye,{})}),e(R,{onClick:ie,children:e(be,{style:{marginLeft:"10px"}})}),i(E,{open:c,style:{overflow:"scroll"},onClose:A,maxWidth:"xs",fullWidth:!0,children:[e(ae,{children:"Send Report To Partner"}),e(F,{sx:{display:"flex",flexDirection:"column"},children:a?e(Pe,{container:!0}):i(x,{container:!0,sx:{mt:"0.2rem"},spacing:2,children:[P.map((p,r)=>{var n;return i(y.Fragment,{children:[e(x,{item:!0,xs:9,children:e(W,{control:o,defaultValue:((n=u.emails[r])==null?void 0:n.email)||"",name:`emails[${r}].email`,rules:{required:!0,pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/},render:({field:{ref:h,...f}})=>e(L,{variant:"outlined",fullWidth:!0,id:`emails[${r}]`,name:`emails[${r}]`,inputRef:h,label:`Partner Email ${r+1}`,placeholder:`Partner Email ${r+1}`,autoComplete:"off",type:"email",error:!!d.emails&&!!d.emails[r],helperText:d.name?"Required Field":`Enter Partner Email ${r+1}`,...f})})}),e(x,{item:!0,xs:2,sx:{display:"flex",alignItems:"center",justifyContent:"left"},children:e(R,{color:"primary",size:"large",onClick:()=>ne(r),style:{borderSpacing:"-1"},children:e(ke,{})})})]},p.id)}),e(x,{item:!0,xs:12,sx:{mY:"0.2rem"},children:i(C,{variant:"outlined",color:"primary",onClick:()=>b(),children:[e(Se,{style:{display:"flex",alignItems:"center",marginRight:"1vh"},children:e(ve,{})}),"Add Another District"]})}),i(x,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"repeat",defaultValue:(X=u.repeat)!=null?X:"Select Timeline",render:({field:{ref:p,...r}})=>i(V,{variant:"outlined",fullWidth:!0,children:[e(j,{id:"repeat-label",children:"Select Timeline"}),e(U,{label:"Select Timeline",placeholder:"Select Timeline",error:!!d.report,id:"repeat",inputRef:p,required:!0,...r,onChange:n=>{const{target:{value:h}}=n;$("date",["Bi-Weekly","Bi-Monthly"].includes(h)?[]:""),r.onChange(n)},children:["Select Timeline","Daily","Weekly","Bi-Weekly","Monthly","Bi-Monthly"].map(n=>e(I,{value:n,disabled:n==="Select Timeline",children:n},n))})]})}),d.repeat?e(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},color:"error",children:"Select Timeline"}):""]}),D!=="Daily"&&i(x,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"date",defaultValue:(J=u.date)!=null?J:"",render:({field:{ref:p,...r}})=>i(V,{variant:"outlined",fullWidth:!0,children:[i(j,{id:"repeat-label",children:["Select ",T?"Day":"Date"]}),i(U,{label:`Select ${T?"Day":"Date"}`,placeholder:`Select ${T?"Day":"Date"}`,error:!!d.date,id:"date",multiple:["Bi-Weekly","Bi-Monthly"].includes(D),inputRef:p,required:!0,renderValue:n=>["Bi-Weekly","Bi-Monthly"].includes(D)?e(Ce,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:n.map(h=>e(De,{onMouseDown:f=>{f.stopPropagation()},label:h,onDelete:()=>{$("date",H.filter(f=>f!==h))}},h))}):n,...r,children:[i(I,{value:"",disabled:!0,children:["Select ",T?"Day":"Date"]}),(T?Ge:Ye).map(n=>i(I,{value:n,disabled:n==="Select Timeline",children:[["Bi-Weekly","Bi-Monthly"].includes(D)&&e(xe,{size:"small",checked:H.includes(n)}),n]},n))]})]})}),d.date?i(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},color:"error",children:["Select ",T?"Day":"Date"]}):""]}),i(x,{item:!0,xs:12,children:[e(W,{control:o,rules:{required:!0},name:"status",defaultValue:(K=u.status)!=null?K:1,render:({field:{ref:p,...r}})=>i(V,{variant:"outlined",fullWidth:!0,children:[e(j,{id:"repeat-label",children:"Select Status"}),e(U,{label:"Select Status",placeholder:"Select Status",error:!!d.status,id:"status",inputRef:p,required:!0,...r,children:[{value:"Select Status",label:"Select Status"},{value:1,label:"Yes"},{value:0,label:"No"}].map(({value:n,label:h})=>e(I,{value:n,disabled:n==="Select Status",children:h},n))})]})}),e(z,{style:{paddingLeft:"0.8rem",paddingTop:"0.4rem",paddingBottom:"0.4rem"},children:"Do you want to share report ?"})]})]})}),i(Y,{children:[e(C,{variant:"outlined",onClick:A,children:"Cancel"}),e(C,{variant:"contained",color:"primary",disabled:a,onClick:k(u.emailreportId?se:le),children:u.emailreportId?"Edit Send Report":"Send Report"})]})]})]})},He="https://join.navgurukul.org/api/",Xe=G(()=>({innerTable:{marginLeft:"3vw",marginRight:"3vw",width:"94vw",marginTop:"5",marginBottom:"5",[N.breakpoints.up("md")]:{margin:"auto",marginTop:5,marginBottom:5}},buttons:{display:"flex",gap:N.spacing(2),margin:N.spacing(2)}})),Je=s=>[{name:"id",label:"Edit Partner Details",options:{filter:!1,sort:!0,customBodyRender:t=>e(ze,{value:t})}},{name:"name",label:"Name",options:{filter:!0,sort:!0,filterType:"custom",filterOptions:{logic:(t,a)=>a[0]==="All"||a[0]===void 0?!1:!a.includes(t),display:(t,a,l,c)=>i(q,{children:[e(Be,{variant:"caption",children:"Name"}),e(Ae,{options:[{name:"All"},...s].map(({name:m})=>({value:m,label:m})),filterList:t,onChange:a,index:l,column:c,value:t[l].length===0?"All":t[l]})]}),fullWidth:!0},customBodyRender:(t,a)=>{const l=a.rowData[0];return e(Q,{url:`/partner/${l}`,text:t,name:t})}}},{name:"notes",label:"View Assessments",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>e(Ie,{partnerId:a.rowData[0]})}},{name:"name",label:"Create Assessment",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>e(_e,{partnerId:a.rowData[0],partnerName:t})}},{name:"id",label:"Joined Students Progress",options:{filter:!1,sort:!1,customBodyRender:(t,a)=>{const l=a.rowData[3];return e(Q,{url:`/partner/${t}/progress`,text:"Get Information",name:l})}}},{name:"slug",label:"Online Test For Partner",options:{filter:!1,sort:!1,customBodyRender:(t,a,l)=>{if(t){const c=`/partnerLanding/${t}`;return e("div",{children:e("a",{href:c,target:"_blank",rel:"noreferrer noopener",style:{color:"#f05f40"},children:"Go for test"})})}return e(Ee,{columnIndex:a.columnIndex,partnerId:a.rowData[0],name:a.rowData[3],notes:a.rowData[2],change:c=>l(c)})}}},{name:"meraki_link",label:"Meraki Link",options:{filter:!1,sort:!1,customBodyRender:(t,a,l)=>e(Ue,{isValue:t,studentId:a.rowData[0],updateValue:l})}},{name:"id",label:"Send Report",options:{filter:!1,sort:!1,customBodyRender:t=>e(Ze,{partnerId:t})}}],pt=()=>{const s=Xe(),{privileges:t}=re(o=>o.auth),a=$e(),[l,c]=y.useState(!0),[m,u]=y.useState([]),g=o=>{u(o)},k=async()=>{try{const o=`${He}partners`,S=await v.get(o,{headers:{Authorization:`Bearer ${localStorage.getItem("jwt")}`}});g(S.data.data)}catch(o){console.error(o)}};Te.exports.useEffect(()=>{(async()=>(c(!0),await k(),c(!1)))()},[]);const d={customToolbar:y.useCallback(()=>e(we,{handleOpen:()=>a("/partner/add"),disabled:!t.some(o=>o.privilege==="AddPartner")}),[])};return e(te,{children:e(Re,{theme:N,children:e("div",{className:s.innerTable,children:e(Le,{title:"Partners",columns:Je(m),data:m,options:d,tableBodyMaxHeight:"74vh",showLoader:l})})})})};export{pt as default};
